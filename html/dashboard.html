<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel='stylesheet' href='https://unicons.iconscout.com/release/v3.0.6/css/line.css'><link rel="stylesheet" href="./dashboard.css">
  <link rel="stylesheet" href="./style.css">
  <!-- AdminLTE CSS -->
<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css'>
<link rel="stylesheet" href='https://cdn.jsdelivr.net/npm/admin-lte@3.2.0/dist/css/adminlte.min.css'>
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
</head>
<body>
<!-- partial:index.partial.html -->
<aside class="sidebar position-fixed top-0 left-0 overflow-auto h-100 float-left" id="show-side-navigation1">
  <i class="uil-bars close-aside d-md-none d-lg-none" data-close="show-side-navigation1"></i>
  <div class="sidebar-header d-flex justify-content-center align-items-center px-3 py-4">
    <img id="visit"
    class="rounded-pill img-fluid"
    width="65"
    height="65"
    src="https://cdn-icons-png.flaticon.com/512/2714/2714708.png"
    alt="">
    <div class="ms-2">
      <h5 class="fs-6 mb-0">
        <a class="text-decoration-none" href="#" id="userName" style="cursor: default;">Visitante</a>
      </h5>
      <p class="mt-1 mb-0">Leitor do consumo.</p>
    </div>
    <div id="sidebar-perfback">
    
    </div>
  </div>

  <ul class="categories list-unstyled">
    <li class="has-dropdown">
      <i class="uil-estate fa-fw"></i><a href="#"> Dashboard</a>
      <ul class="sidebar-dropdown list-unstyled ">
        <li class="dropdown-divider"></li>
        <li><a href="#myChart">Balanço do consumo de energia no ano atual</a></li>
        <li class="dropdown-divider"></li>
        <li><a href="#myChart2">Consumo de energia em R$</a></li>
        <li class="dropdown-divider"></li>
        <li><a href="#donutChart">Gasto de energia por estação em R$</a></li>
        <li class="dropdown-divider"></li>
        <li><a href="#mes">Mês atual</a></li>
        <li class="dropdown-divider"></li>
        <li><a href="#chart3">Balanço do consumo de energia em anos anteriores</a></li>
        <li class="dropdown-divider"></li>
      </ul>
    </li>
    <!-- <li>
      <i class="uil-folder"></i>
      <a href="#" id="uploadTrigger" style="z-index: 1002;">Planilha</a>
        <input type="file" id="fileInput" name="file" accept=".xlsx,.csv" style="display: none;" />
    </li> -->
  <!-- <li class=""> 
      <i class="uil-eye"></i><a href="/relatorio.html"> Relatórios</a>
    </li>-->
    <li>
      <i class="uil-calendar-alt"></i><a href="https://www.supercalendario.com.br/2024" target="_blank"> Calendario</a>
    </li>
    <li>
      <i class="uil-envelope-download fa-fw"></i><a href="https://mail.google.com/mail/?authuser=0" target="_blank"> Caixa de e-mails</a>
    </li>
    
    <li class="">
      <i class="uil-setting"></i><a href="#" id="config"> Configurações</a>
    </li>
    
    <li class="">
      <i class="uil-map-marker"></i><a target="_blank" href="https://www.google.com/maps/place/Salvador+-+BA/@-12.9146545,-38.4474086,24187m/data=!3m1!1e3!4m6!3m5!1s0x716037ca23ca5b3:0x1b9fc7912c226698!8m2!3d-12.9777334!4d-38.501648!16zL20vMDl3d2xq?entry=ttu&g_ep=EgoyMDI0MTEyNC4xIKXMDSoASAFQAw%3D%3D"> Mapa</a>
    </li>
  </ul>
</aside>

<section id="wrapper">
  <nav class="navbar navbar-expand-md">
    <div class="container-fluid mx-2">
      <div class="navbar-header">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#toggle-navbar" aria-controls="toggle-navbar" aria-expanded="false" aria-label="Toggle navigation">
          <i class="uil-bars text-white"></i>
        </button>
        <a class="navbar-brand" href="#"> 
          <img style="position: absolute; margin-top: -42px;" width="70px" height="auto" src="/logo_biogas.png" alt="">
        </a>
        <h4 style="position: absolute; margin-left: 70px; margin-top: -24px; color: aliceblue;">EcoBiogás</h4>
      </div>
      <div class="collapse navbar-collapse" id="toggle-navbar">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle"  id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Menu
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown" style="padding: 15px; ">
              <li>
                <a class="dropdown-item" href="#" id="conta">Minha Conta</a>
              </li>
              <li><a class="dropdown-item" href="https://mail.google.com/mail/?authuser=0" target="_blank">Minhas Mensagens</a>
              </li>
              <li><a class="dropdown-item" href="/ajuda_pdf.pdf" target="_blank">Ajuda</a>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="#" id="logoutButton">Desconectar</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://mail.google.com/mail/?view=cm&fs=1&to=ecobiogas@gmail.com" target="_blank"><i class="uil-comments-alt"></i></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="uil-bell"></i><span>0</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <i data-show="show-side-navigation1" class="uil-bars show-side-btn"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- 
    <div class="chat">
      <div class="chat-title">
        <h1>Fabio Ottaviani</h1>
        <h2>Supah</h2>
        <figure class="avatar">
          <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/156381/profile/profile-80.jpg" /></figure>
        </div>
        <div class="messages">
          <div class="messages-content"></div>
        </div>
        <div class="message-box">
          <textarea type="text" class="message-input" placeholder="Type message..."></textarea>
      <button type="submit" class="message-submit">Send</button>
    </div>
  
  </div>
  <div class="bg"></div>
  -->

  <div class="p-4">
    <div class="welcome">
      <div class="content rounded-3 p-3">
        <h1 class="fs-3">Bem vindo ao Dashboard</h1>
        <p class="mb-0">Olá, bem vindo ao seu dashboard!</p>
      </div>
    </div>

    <section class="statis mt-4 text-center">
      <div class="row">
        <div class="col-md-6 col-lg-3 mb-4 mb-lg-0">
          <div class="box bg-primary p-3">
            <i class="uil-eye"></i>
            <h3 id="temperatura">--°C</h3>
            <p class="lead">Temperatura</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-4 mb-lg-0">
          <div class="box p-3" style="background-color: rgb(201, 13, 13);">
            <i class="uil-estate"></i>
            <h3 id="umidade">--%</h3>
            <p class="lead">Umidade</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-4 mb-md-0">
          <div class="box bg-warning p-3">
            <i class="uil-bell"></i>
            <h3 id="qualidade">--%</h3>
            <p class="lead">Qualidade do ar</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="box bg-success p-3" id="mes">
            <i class="uil-calendar-alt"></i>
            <h3 id="timestamp">----h</h3>
            <p class="lead">Última atualização</p>
          </div>
        </div>
      </div>
    </section>

    <section class="charts mt-4">
      <div class="row">
        <div class="col-lg-6">
          <div class="chart-container rounded-2 p-3">
            <h3 class="fs-6 mb-3">Balanço dos picos de temperatura e umidade no ano atual</h3>
            <div style="height: 250px; width: 100%;">
            <canvas id="myChart"></canvas>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="chart-container rounded-2 p-3">
            <h3 class="fs-6 mb-3">Qualidade do ar no ano atual</h3>
            <div style="height: 250px; width: 100%;">
              <canvas id="myChart2"></canvas>
            </div> 
          </div>
        </div>
      </div>
    </section>

    <section class="admins mt-4">
      <div class="row">
        
         
            <div class="card card-danger" >
              <div class="card-body" style="background-color: #E5E7EB; border-radius: 5px;">
                <h3 class="card-title">Média de temperatura por estação do ano</h3>
                <div class="chartjs-size-monitor">
                  <div class="chartjs-size-monitor-expand">
                    <div class=""></div>
                  </div>
                  <div class="chartjs-size-monitor-shrink">
                    <div class=""></div>
                  </div>
                </div>
                <canvas id="donutChart" style="min-height: 250px; height: 310px; max-height: 310px; max-width: 100%; display: block; width: 765px;" width="765" height="250" class="chartjs-render-monitor"></canvas>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- <h4>Admins:</h4> -->

          
       
        
        </div>
      </div>
    

    <section class="statistics mt-4">
      <div class="row">
        <div class="col-lg-4">
          <div class="box d-flex rounded-2 align-items-center mb-4 mb-lg-0 p-3">
            <i class="uil-envelope-shield fs-2 text-center rounded-circle" style="background-color: rgb(4, 0, 255);"></i>
            <div class="ms-3">
              <div class="d-flex align-items-center">
                <h3 class="mb-0 numerosstats">0</h3> <span class="d-block ms-2">Comunicados</span>
              </div>
              <p class="fs-normal mb-0">Comunicados dos riscos de incêndio nas ultimas 24 horas</p>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="box d-flex rounded-2 align-items-center mb-4 mb-lg-0 p-3">
            <i class="uil-file fs-2 text-center bg-danger rounded-circle"></i>
            <div class="ms-3">
              <div class="d-flex align-items-center">
                <h3 class="mb-0 numerosstats" id="fileCount">1</h3> <span class="d-block ms-2">Nó</span>
              </div>
              <p class="fs-normal mb-0">Quantidade de Nó de comunicação dos sensores</p>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="box d-flex rounded-2 align-items-center p-3">
            <i class="uil-users-alt fs-2 text-center bg-success rounded-circle"></i>
            <div class="ms-3">
              <div class="d-flex align-items-center">
                <h3 class="mb-0 numerosstats">00:00</h3> <span class="d-block ms-2">Horas</span>
              </div>
              <p class="fs-normal mb-0">Última atualização dos dados</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    
    

    <section class="charts mt-4">
      <div class="row">
        <div class="chart-container rounded-2 p-3" style="width: 100%;">
          <h3 class="fs-6 mb-3">Balanço nos últimos 7 dias</h3>
          <div style="height: 300px; width: 100% ;">
            <canvas id="chart3" ></canvas>
          </div>
      </div>
    </div>
    </section>
    
    

  </div>
</section>
</section>

<!-- partial -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.js"></script>
  

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Bootstrap (depende de jQuery) -->
<script src='https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js'></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.1/xlsx.full.min.js"></script>

<!-- AdminLTE -->
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2.0/dist/js/adminlte.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>

<script  src="./dashboard.js"></script>


<script>
  // Requisição para obter o número de arquivos na pasta uploads
  fetch('/uploads/count')
    .then(response => response.json())
    .then(data => {
      document.getElementById('fileCount').textContent = data.count;
    })
    .catch(error => {
      console.error('Erro ao obter o número de arquivos:', error);
    });

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'center' // Centraliza o elemento na vertical
        });
      }
    });
  });

  document.addEventListener('DOMContentLoaded', () => {
    fetch('/user/profile', {
      method: 'GET',
      credentials: 'include',
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const userNameElement = document.getElementById('userName');
          userNameElement.textContent = data.nome;
        } else {
          console.error('Erro:', data.message);
        }
      })
      .catch(error => {
        console.error('Erro ao buscar dados do usuário:', error);
      });
  });


  document.getElementById('logoutButton').addEventListener('click', function() {
    fetch('/logout', {
        method: 'POST',
        credentials: 'include', // Inclui os cookies/sessão na requisição
    })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Logout bem-sucedido, redirecionar para a página de login
                window.location.href = '/login.html';
            } else {
                alert(data.message);
            }
        })
        .catch(error => {
            console.error('Erro ao deslogar:', error);
        });
});

document.getElementById('conta').addEventListener('click', function (e) {
    e.preventDefault(); // Evita o comportamento padrão do link
    verificarLogin();
  });
document.getElementById('config').addEventListener('click', function (e) {
    e.preventDefault(); // Evita o comportamento padrão do link
    verificarLogin2();
  });

  function verificarLogin() {
  fetch('/user/profile', {
    method: 'GET',
    credentials: 'include' // Inclui cookies/sessões na requisição
  })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // Usuário está logado, redireciona para a página "Minha Conta"
        window.location.href = '/config.html?content=profile';
      } else {
        // Usuário não está logado, redireciona para a página de login
        window.location.href = '/login.html';
      }
    })
    .catch(error => {
      console.error('Erro ao verificar login:', error);
      // Opcional: redireciona para login em caso de erro
      window.location.href = '/login.html';
    });
}
  function verificarLogin2() {
  fetch('/user/profile', {
    method: 'GET',
    credentials: 'include' // Inclui cookies/sessões na requisição
  })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // Usuário está logado, redireciona para a página "Minha Conta"
        window.location.href = '/config.html?content=general';
      } else {
        // Usuário não está logado, redireciona para a página de login
        window.location.href = '/login.html';
      }
    })
    .catch(error => {
      console.error('Erro ao verificar login:', error);
      // Opcional: redireciona para login em caso de erro
      window.location.href = '/login.html';
    });
}

document.addEventListener('DOMContentLoaded', () => {
    fetch('/get-pessoascasa')
        .then(response => response.json())
        .then(data => {
          if (data.pessoas === undefined) {
          document.getElementById('pessoasnacasa').textContent = 1; // Definindo o valor do texto
          }
          if (data.pessoas !== undefined) {
             document.getElementById('pessoasnacasa').textContent = data.pessoas;
          }
        })
        .catch(err => console.error('Erro ao obter dados:', err));
});

//chat


</script>
</body>
</html>
